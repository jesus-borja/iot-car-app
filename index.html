<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Carrito IoT - Control</title>
    <link rel="icon"
        href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ðŸš—</text></svg>">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="css/style.css">
</head>

<body data-theme="dark" data-bs-theme="dark">
    <header class="d-flex justify-content-between align-items-center">
        <div class="header-left d-flex justify-content-between align-items-center gap-4">
            <h1 class="m-0">Carrito IoT</h1>
            <div class="select-wrapper">
                <select class="devices-select" name="devices-select" id="devices-select"></select>
            </div>
        </div>
        <nav class="header-right">
            <button class="nav-button active">Control</button>
            <a href="./monitor.html" class="nav-button">Monitoreo</a>
        </nav>
    </header>

    <main class="container-fluid p-4 flex-grow-1 d-flex flex-column">
        <div class="row g-4 h-100">

            <div class="col-12 col-lg-3">
                <section class="speed-control h-100">

                    <h2>Velocidad</h2>

                    <div class="speed-input-container flex-grow-1">

                        <div class="slider-wrapper">
                            <input type="range" id="speedInput" min="0" max="3" step="1" value="2">
                        </div>

                        <div class="speed-labels">
                            <span class="label-item" data-val="3">RÃ¡pido</span>
                            <span class="label-item" data-val="2">Normal</span>
                            <span class="label-item" data-val="1">Lento</span>
                            <span class="label-item reversa" data-val="0">Reversa</span>
                        </div>
                    </div>

                    <div class="demos-container d-flex flex-column gap-3 mt-4 justify-content-between">
                        <h2>Demos</h2>
                        <select class="devices-select" name="demos-select" id="demos-select"></select>
                        <button class="spin-btn mt-4" id="play-demo">Ejecutar demo</button>
                        <button class="spin-btn mt-4" data-bs-toggle="modal" data-bs-target="#add-demo">Agregar
                            demo</button>
                    </div>
                </section>
            </div>

            <div class="col-12 col-lg-6">
                <section class="direction-control h-100 justify-content-center">
                    <h2>Movimiento</h2>
                    <div class="canvas-wrapper">
                        <div class="directional-pad-container">
                            <canvas id="controlCanvas" width="480" height="480"></canvas>
                            <button class="stop-btn" data-action="detener">Detener</button>
                        </div>
                    </div>

                    <div class="d-flex gap-3 mt-4 justify-content-center w-100">
                        <button class="spin-btn" id="spinLeft" title="Giro 360 Izquierda">
                            <span>&#8634;</span> 360Â° Izq
                        </button>
                        <button class="spin-btn" id="spinRight" title="Giro 360 Derecha">
                            360Â° Der <span>&#8635;</span>
                        </button>
                    </div>

                    <div class="mt-4">
                        <h3 id="last-action">Cargando...</h3>
                    </div>

                </section>
            </div>

            <div class="col-12 col-lg-3">
                <section class="history-log h-100">
                    <h2>Ãšltimos Movimientos</h2>
                    <ul id="movement-history" class="h-100">
                        <li>Inicializando...</li>
                    </ul>
                </section>
            </div>
        </div>
    </main>

    <div class="modal fade" id="add-demo" tabindex="-1" aria-labelledby="addDemoLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h1 class="modal-title fs-5" id="addDemoLabel">Agregar demo</h1>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <p>Nombre para la demo: </p>
                    <input id="demo-name" type="text" class="form-control" placeholder="Paso lunar">
                    <p class="mt-3">Selecciona los pasos para crear la demo</p>

                    <div class="steps-container d-flex gap-3 flex-column mt-3 justify-content-center w-100"
                        id="steps-container">
                        <div class="steps-wrapper d-flex gap-3 justify-content-center w-100" id="steps-wrapper">
                            <select class="steps-select devices-select" name="steps-select" id="steps-select"></select>
                            <select class="devices-select" name="speed-select" id="speed-select">
                                <option value="0">Reversa</option>
                                <option value="1">Lento</option>
                                <option value="2" selected>Normal</option>
                                <option value="3">RÃ¡pido</option>
                            </select>
                            <input type="text" class="form-control" value="1s" pattern="[0-1]+s?">
                            <button disabled type="button" class="btn btn-secondary" id="step-remove"><svg
                                    xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                                    class="bi bi-trash3" viewBox="0 0 16 16">
                                    <path
                                        d="M6.5 1h3a.5.5 0 0 1 .5.5v1H6v-1a.5.5 0 0 1 .5-.5M11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3A1.5 1.5 0 0 0 5 1.5v1H1.5a.5.5 0 0 0 0 1h.538l.853 10.66A2 2 0 0 0 4.885 16h6.23a2 2 0 0 0 1.994-1.84l.853-10.66h.538a.5.5 0 0 0 0-1zm1.958 1-.846 10.58a1 1 0 0 1-.997.92h-6.23a1 1 0 0 1-.997-.92L3.042 3.5zm-7.487 1a.5.5 0 0 1 .528.47l.5 8.5a.5.5 0 0 1-.998.06L5 5.03a.5.5 0 0 1 .47-.53Zm5.058 0a.5.5 0 0 1 .47.53l-.5 8.5a.5.5 0 1 1-.998-.06l.5-8.5a.5.5 0 0 1 .528-.47M8 4.5a.5.5 0 0 1 .5.5v8.5a.5.5 0 0 1-1 0V5a.5.5 0 0 1 .5-.5" />
                                </svg></button>
                        </div>
                    </div>
                    <button class="spin-btn mt-3" id="add-step-to-demo">Agregar paso</button>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
                    <button id="add-demo-btn" class="spin-btn">Guardar demo</button>
                </div>
            </div>
        </div>
    </div>

    <footer class="mt-auto">
        <p>&copy; 2025 | Hecho por <a href="#" target="_blank">JesÃºs Borja</a></p>
    </footer>

    <script defer src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script defer src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
    <script defer src="js/script.js"></script>
</body>

</html>